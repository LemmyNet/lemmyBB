{{> components/header }}

<h2 class="topic-title"><a href="./viewtopic?t={{ post.post_view.post.id }}">{{ post.post_view.post.name }}</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Description of your first forum.<br /></div>


<div class="action-bar bar-top">

    <a href="./comment_editor?t={{ post.post_view.post.id }}" class="button" title="Post a reply">
        <span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
    </a>


    {{> components/pagination }}
</div>

{{#if (eq pagination.current_page 1)}}
<div id="p1" class="post has-profile bg2">
    <div class="inner">

        {{> components/post_profile user=post.post_view.creator }}

        <div class="postbody">
            <div id="post_content1">

                <h3 class="first">
                    <a href="./viewtopic?p={{post.post_view.post.id}}#p1">{{post.post_view.post.name}}</a>
                </h3>
                {{#if site_data.site.my_user.local_user_view.person.id}}
                <ul class="post-buttons">
                    {{#if (eq post.post_view.creator.id site_data.site.my_user.local_user_view.person.id)}}
                    <li>
                        <a href="/post_editor?f={{post.post_view.community.id}}&edit={{post.post_view.post.id}}" title="Edit post" class="button button-icon-only">
                            <i class="icon fa-pencil fa-fw" aria-hidden="true"></i><span class="sr-only">Edit</span>
                        </a>
                    </li>
                    {{/if}}
                    <li>
                        <a href="/report?thread={{post.post_view.post.id}}" title="Report this post" class="button button-icon-only">
                        <i class="icon fa-exclamation fa-fw" aria-hidden="true"></i><span class="sr-only">Report</span>
                        </a>
                    </li>
                </ul>
                {{/if}}
                <p class="author">
                    <a class="unread" href="./viewtopic?t={{post.post_view.post.id}}#p1" title="Post">
                        <i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
                    </a>
                    <span class="responsive-hide">by <strong><a href="/view_profile?u={{post.post_view.creator.id}}" class="username">{{{user_actor_id post.post_view.creator}}}</a></strong> &raquo; </span>
                    <time datetime="{{timestamp_machine post.post_view.post.published}}">{{timestamp_human post.post_view.post.published}}</time>
                </p>
                <div class="content">
                    {{#if post.post_view.post.url}}
                        {{#if is_image_url}}
                            <img src="{{post.post_view.post.url}}" />
                            <br />
                            <br />
                        {{else}}
                            <a href="{{post.post_view.post.url}}">{{post.post_view.post.url}}</a>
                            <br />
                            <br />
                        {{/if}}
                    {{/if}}
                    {{{markdown post.post_view.post.body}}}
                </div>
                {{#if post.post_view.creator.bio}}
                    <div class="signature">
                        {{{markdown post.post_view.creator.bio}}}
                    </div>
                {{/if}}
            </div>
        </div>

        <div class="back2top">
            <a href="#top" class="top" title="Top">
                <i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
                <span class="sr-only">Top</span>
            </a>
        </div>

    </div>
</div>
{{/if}}

{{#each post.comments}}
<div id="p{{this.comment.id}}" class="post has-profile bg{{add (mod @index 2) 1}}">
    <div class="inner">

        {{> components/post_profile user=this.creator }}

        <div class="postbody">
            <h3>
                <a href="./viewtopic?p={{this.post.id}}#p1">{{this.post.name}}</a>
            </h3>
            {{#if ../site_data.site.my_user.local_user_view.person.id}}
            <ul class="post-buttons">
                {{#if (eq this.creator.id ../site_data.site.my_user.local_user_view.person.id)}}
                    <li>
                        <a href="/comment_editor?t={{this.post.id}}&edit={{this.comment.id}}" title="Edit post" class="button button-icon-only">
                        <i class="icon fa-pencil fa-fw" aria-hidden="true"></i><span class="sr-only">Edit</span>
                        </a>
                    </li>
                {{/if}}
                <li>
                    <a href="/report?reply={{this.comment.id}}" title="Report this post" class="button button-icon-only">
                        <i class="icon fa-exclamation fa-fw" aria-hidden="true"></i><span class="sr-only">Report</span>
                    </a>
                </li>
            </ul>
            {{/if}}
            <p class="author">
                <a class="unread" href="./viewtopic?t={{this.post.id}}&page={{../pagination.current_page}}#p{{this.comment.id}}" title="Post">
                    <i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
                </a>
                <span class="responsive-hide">by <strong><a href="/view_profile?u={{this.creator.id}}" class="username">{{{user_actor_id this.creator}}}</a></strong> &raquo; </span>
                <time datetime="{{timestamp_machine this.comment.published}}">{{timestamp_human this.comment.published}}</time>
                {{#if this.comment.parent_id}}
                    <span style="float: right; margin-right: 48px">
                        Responding to <a href="./viewtopic?t={{this.post.id}}&page={{comment_page this.comment.parent_id ../all_comments}}#p{{this.comment.parent_id}}">#{{this.comment.parent_id}}</a>
                    </span>
                {{/if}}
            </p>
            <div class="content">{{{markdown this.comment.content}}}</div>
        </div>
        {{#if this.creator.bio}}
            <div class="signature truncated">
                {{{markdown this.creator.bio}}}
                <div class="buttons">
                    <button class="button remove" onclick="$('div.signature').removeClass('truncated')">Read more...</button>
                    <button class="button add" onclick="$('div.signature').addClass('truncated')">Read less...</button>
                </div>
            </div>
        {{/if}}

        <div class="back2top">
            <a href="#top" class="top" title="Top">
                <i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
                <span class="sr-only">Top</span>
            </a>
        </div>

    </div>
</div>
{{/each}}

<div class="action-bar bar-bottom">

    <a href="./comment_editor?t={{post.post_view.post.id}}" class="button" title="Post a reply">
        <span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
    </a>

    {{> components/pagination }}
</div>

{{> components/footer }}
